Java.perform(function () {
    try {
        var activityThread = Java.use('android.app.ActivityThread');
        var currentActivityThread = activityThread.currentActivityThread();
        var activities = currentActivityThread.mActivities.value;

        var activitiesKeys = activities.keySet().toArray();
        var foregroundActivity = null;

        for (var i = 0; i < activitiesKeys.length; i++) {
            var key = activitiesKeys[i];
            var activityRecord = activities.get(key);

            if (!activityRecord) continue;

            var activity = null;
            try {
                activity = activityRecord.activity.value;
            } catch (e) {
                // Sometimes activity might not exist on the record, skip safely
                continue;
            }

            if (activity && !activity.isFinishing()) {
                foregroundActivity = activity.getClass().getName();
                break;
            }
        }

        if (foregroundActivity) {
            console.log("Current foreground activity: " + foregroundActivity);
        } else {
            console.log("No foreground activity found.");
        }
    } catch (e) {
        console.log("Error: " + e.message);
    }
});
